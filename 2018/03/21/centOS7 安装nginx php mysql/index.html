<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="nginx安装本文是介绍使用源码编译安装，包括具体的编译参数信息。 正式开始前，编译环境gcc g++ 开发库之类的需要提前装好。 安装make：1yum -y install gcc automake autoconf libtool make 安装g++:1yum install gcc gcc-c++ 1.选定源码目录可以是任何目录，本文选定的是/root/1cd /root/ 2.安装PC">
<meta property="og:type" content="article">
<meta property="og:title" content="centOS7 安装nginx php mysql">
<meta property="og:url" content="http://blog.msrily.com/2018/03/21/centOS7 安装nginx php mysql/index.html">
<meta property="og:site_name" content="静谧星空的博客">
<meta property="og:description" content="nginx安装本文是介绍使用源码编译安装，包括具体的编译参数信息。 正式开始前，编译环境gcc g++ 开发库之类的需要提前装好。 安装make：1yum -y install gcc automake autoconf libtool make 安装g++:1yum install gcc gcc-c++ 1.选定源码目录可以是任何目录，本文选定的是/root/1cd /root/ 2.安装PC">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://blog.msrily.com/2018/03/21/centOS7%20安装nginx%20php%20mysql/20180320174221.png">
<meta property="og:updated_time" content="2018-03-21T06:29:05.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="centOS7 安装nginx php mysql">
<meta name="twitter:description" content="nginx安装本文是介绍使用源码编译安装，包括具体的编译参数信息。 正式开始前，编译环境gcc g++ 开发库之类的需要提前装好。 安装make：1yum -y install gcc automake autoconf libtool make 安装g++:1yum install gcc gcc-c++ 1.选定源码目录可以是任何目录，本文选定的是/root/1cd /root/ 2.安装PC">
<meta name="twitter:image" content="http://blog.msrily.com/2018/03/21/centOS7%20安装nginx%20php%20mysql/20180320174221.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.msrily.com/2018/03/21/centOS7 安装nginx php mysql/"/>





  <title>centOS7 安装nginx php mysql | 静谧星空的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">静谧星空的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.msrily.com/2018/03/21/centOS7 安装nginx php mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="静谧星空">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="静谧星空的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">centOS7 安装nginx php mysql</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-21T14:28:15+08:00">
                2018-03-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="nginx安装"><a href="#nginx安装" class="headerlink" title="nginx安装"></a>nginx安装</h2><p>本文是介绍使用源码编译安装，包括具体的编译参数信息。</p>
<p>正式开始前，编译环境gcc g++ 开发库之类的需要提前装好。</p>
<p>安装make：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc automake autoconf libtool make</span><br></pre></td></tr></table></figure></p>
<p>安装g++:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc gcc-c++</span><br></pre></td></tr></table></figure></p>
<h3 id="1-选定源码目录"><a href="#1-选定源码目录" class="headerlink" title="1.选定源码目录"></a>1.选定源码目录</h3><p>可以是任何目录，本文选定的是/root/<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/</span><br></pre></td></tr></table></figure></p>
<h3 id="2-安装PCRE库"><a href="#2-安装PCRE库" class="headerlink" title="2.安装PCRE库"></a>2.安装PCRE库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/</span><br><span class="line">wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.41.tar.gz</span><br><span class="line">tar -zxvf pcre-8.41.tar.gz</span><br><span class="line"><span class="built_in">cd</span> pcre-8.41</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h3 id="3-安装zlib库"><a href="#3-安装zlib库" class="headerlink" title="3.安装zlib库"></a>3.安装zlib库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/</span><br><span class="line">wget http://zlib.net/zlib-1.2.11.tar.gz</span><br><span class="line">tar -zxvf zlib-1.2.11.tar.gz </span><br><span class="line"><span class="built_in">cd</span> zlib-1.2.11</span><br><span class="line">./configure </span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h3 id="4-安装ssl"><a href="#4-安装ssl" class="headerlink" title="4.安装ssl"></a>4.安装ssl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/</span><br><span class="line">wget https://www.openssl.org/<span class="built_in">source</span>/openssl-1.1.0g.tar.gz</span><br><span class="line">tar -zxvf openssl-1.1.0g</span><br><span class="line"><span class="built_in">cd</span> openssl-1.1.0g</span><br><span class="line">./config </span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h3 id="5-安装nginx"><a href="#5-安装nginx" class="headerlink" title="5.安装nginx"></a>5.安装nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/</span><br><span class="line">wget http://nginx.org/download/nginx-1.13.9.tar.gz</span><br><span class="line">tar -zxvf nginx-1.13.9.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nginx-1.13.9</span><br><span class="line">groupadd -r nginx</span><br><span class="line">useradd -r -g nginx nginx</span><br><span class="line">./configure \</span><br><span class="line">--prefix=/usr/<span class="built_in">local</span>/nginx \</span><br><span class="line">--sbin-path=/usr/<span class="built_in">local</span>/nginx/sbin/nginx \</span><br><span class="line">--conf-path=/usr/<span class="built_in">local</span>/nginx/nginx.conf \</span><br><span class="line">--pid-path=/usr/<span class="built_in">local</span>/nginx/nginx.pid \</span><br><span class="line">--user=nginx \</span><br><span class="line">--group=nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_v2_module \</span><br><span class="line">--with-http_flv_module \</span><br><span class="line">--with-http_mp4_module  \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--http-client-body-temp-path=/var/tmp/nginx/client/ \</span><br><span class="line">--http-proxy-temp-path=/var/tmp/nginx/proxy/ \</span><br><span class="line">--http-fastcgi-temp-path=/var/tmp/nginx/fcgi/ \</span><br><span class="line">--http-uwsgi-temp-path=/var/tmp/nginx/uwsgi \</span><br><span class="line">--http-scgi-temp-path=/var/tmp/nginx/scgi \</span><br><span class="line">--with-pcre=/root/pcre-8.41 \</span><br><span class="line">--with-zlib=/root/zlib-1.2.11 \</span><br><span class="line">--with-openssl=/root/openssl-1.1.0g</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h2 id="php-fpm安装配置"><a href="#php-fpm安装配置" class="headerlink" title="php-fpm安装配置"></a>php-fpm安装配置</h2><p>nginx本身不能处理PHP，它只是个web服务器，当接收到请求后，如果是php请求，则发给php解释器处理，并把结果返回给客户端。</p>
<p>nginx一般是把请求发fastcgi管理进程处理，fascgi管理进程选择cgi子进程处理结果并返回被nginx</p>
<p>本文以php-fpm为例介绍如何使nginx支持PHP</p>
<h3 id="一、编译安装php-fpm"><a href="#一、编译安装php-fpm" class="headerlink" title="一、编译安装php-fpm"></a>一、编译安装php-fpm</h3><p>什么是PHP-FPM</p>
<p>PHP-FPM是一个PHP FastCGI管理器，是只用于PHP的,可以在 <a href="http://php-fpm.org/download下载得到" target="_blank" rel="noopener">http://php-fpm.org/download下载得到</a>.</p>
<p>PHP-FPM其实是PHP源代码的一个补丁，旨在将FastCGI进程管理整合进PHP包中。必须将它patch到你的PHP源代码中，在编译安装PHP后才可以使用。</p>
<p>新版PHP已经集成php-fpm了，不再是第三方的包了，推荐使用。PHP-FPM提供了更好的PHP进程管理方式，可以有效控制内存和进程、可以平滑重载PHP配置，比spawn-fcgi具有更多优点，所以被PHP官方收录了。在./configure的时候带 –enable-fpm参数即可开启PHP-FPM，其它参数都是配置php的，具体选项含义可以查看这里。</p>
<h5 id="安装前准备"><a href="#安装前准备" class="headerlink" title="安装前准备"></a>安装前准备</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum -y install glibc libmcrypt-devel \ </span><br><span class="line">mhash-devel libxslt-devel libjpeg \</span><br><span class="line">libjpeg-devel libpng libpng-devel \ </span><br><span class="line">freetype freetype-devel libxml2 \ </span><br><span class="line">libxml2-devel zlib zlib-devel glibc \ </span><br><span class="line">glibc-devel glib2 glib2-devel bzip2 \</span><br><span class="line">bzip2-devel ncurses ncurses-devel curl \</span><br><span class="line">curl-devel e2fsprogs e2fsprogs-devel \</span><br><span class="line">krb5 krb5-devel libidn libidn-devel</span><br></pre></td></tr></table></figure>
<h5 id="安装libiconv"><a href="#安装libiconv" class="headerlink" title="安装libiconv"></a>安装libiconv</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/</span><br><span class="line">wget http://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.14.tar.gz</span><br><span class="line">tar -zxvf libiconv-1.14.tar.gz</span><br><span class="line"><span class="built_in">cd</span> libiconv-1.14</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h5 id="安装php"><a href="#安装php" class="headerlink" title="安装php"></a>安装php</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/</span><br><span class="line">wget http://am1.php.net/distributions/php-7.2.3.tar.gz</span><br><span class="line">tar -zxvf php-7.2.3.tar.gz </span><br><span class="line"><span class="built_in">cd</span> php-7.2.3</span><br><span class="line">./configure --with-curl \</span><br><span class="line">    --with-freetype-dir \</span><br><span class="line">    --with-gd \</span><br><span class="line">    --with-gettext \</span><br><span class="line">    --with-iconv-dir \</span><br><span class="line">    --with-kerberos \</span><br><span class="line">    --with-libdir=lib64 \</span><br><span class="line">    --with-libxml-dir \</span><br><span class="line">    --with-mysqli \</span><br><span class="line">    --with-openssl \</span><br><span class="line">    --with-pcre-regex \</span><br><span class="line">    --with-pdo-mysql \</span><br><span class="line">    --with-pdo-sqlite \</span><br><span class="line">    --with-pear \</span><br><span class="line">    --with-png-dir \</span><br><span class="line">    --with-xmlrpc \</span><br><span class="line">    --with-xsl \</span><br><span class="line">    --with-zlib \</span><br><span class="line">    --<span class="built_in">enable</span>-fpm \</span><br><span class="line">    --<span class="built_in">enable</span>-bcmath \</span><br><span class="line">    --<span class="built_in">enable</span>-libxml \</span><br><span class="line">    --<span class="built_in">enable</span>-inline-optimization \</span><br><span class="line">    --<span class="built_in">enable</span>-gd-native-ttf \</span><br><span class="line">    --<span class="built_in">enable</span>-mbregex \</span><br><span class="line">    --<span class="built_in">enable</span>-mbstring \</span><br><span class="line">    --<span class="built_in">enable</span>-opcache \</span><br><span class="line">    --<span class="built_in">enable</span>-pcntl \</span><br><span class="line">    --<span class="built_in">enable</span>-shmop \</span><br><span class="line">    --<span class="built_in">enable</span>-soap \</span><br><span class="line">    --<span class="built_in">enable</span>-sockets \</span><br><span class="line">    --<span class="built_in">enable</span>-sysvsem \</span><br><span class="line">    --<span class="built_in">enable</span>-xml \</span><br><span class="line">    --<span class="built_in">enable</span>-zip</span><br><span class="line">make ZEND_EXTRA_LIBS=<span class="string">'-liconv'</span> &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>PHP 编译安装时出现 undefined reference to `libiconv’ 错误的解决方法<br>在最后面添加 -liconv ，修改后如下<br>EXTRA_LIBS = -lcrypt -lz -lcrypt -lrt -lmysqlclient -lmcrypt -lldap -llber -lfreetype -lpng -lz -ljpeg -lcurl -lz -lrt -lm -ldl -lnsl -lrt -lxml2 -lz -lm -lssl -lcrypto -ldl -lz -lcurl -ldl -lgssapi_krb5 -lkrb5 -lk5crypto -lcom_err -lidn -lssl -lcrypto -lz -lxml2 -lz -lm -lssl -lcrypto -ldl -lz -lxml2 -lz -lm -lxml2 -lz -lm -lcrypt -lxml2 -lz -lm -lxml2 -lz -lm -lxml2 -lz -lm -lxml2 -lz -lm -lcrypt -liconv</p>
<p>报错信息为：<br>configure: error: off_t undefined; check your library configuration</p>
<p>在编译php时会遇到如上问题，这个问题一般在centos 64位系统中比较多见，解决如下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'/usr/local/lib64</span></span><br><span class="line"><span class="string">/usr/local/lib</span></span><br><span class="line"><span class="string">/usr/lib</span></span><br><span class="line"><span class="string">/usr/lib64'</span>&gt;&gt;/etc/ld.so.conf&amp;&amp;ldconfig -v</span><br></pre></td></tr></table></figure></p>
<p>其实就是在这个库配置文件中加入64位库到默认库查找路径中，不然就会报错</p>
<h3 id="1-配置："><a href="#1-配置：" class="headerlink" title="1.配置："></a>1.配置：</h3><h4 id="php配置"><a href="#php配置" class="headerlink" title="php配置"></a>php配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/php.ini</span><br></pre></td></tr></table></figure>
<h4 id="php-fpm配置"><a href="#php-fpm配置" class="headerlink" title="php-fpm配置"></a>php-fpm配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/etc/</span><br><span class="line">cp php-fpm.conf.default php-fpm.conf</span><br><span class="line"><span class="built_in">cd</span> php-fpm.d</span><br><span class="line">cp www.conf.default www.conf</span><br></pre></td></tr></table></figure>
<h6 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h6><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">user = nginx</span><br><span class="line">group = nginx</span><br><span class="line">pm.max_children = <span class="number">150</span></span><br><span class="line">pm.start_servers = <span class="number">8</span></span><br><span class="line">pm.min_spare_servers = <span class="number">5</span></span><br><span class="line">pm.max_spare_servers = <span class="number">10</span></span><br></pre></td></tr></table></figure>
<h3 id="2-运行php-fpm"><a href="#2-运行php-fpm" class="headerlink" title="2.运行php-fpm"></a>2.运行php-fpm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/sbin/php-fpm</span><br></pre></td></tr></table></figure>
<h3 id="3-nginx和php-fpm整合"><a href="#3-nginx和php-fpm整合" class="headerlink" title="3.nginx和php-fpm整合"></a>3.nginx和php-fpm整合</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/nginx.conf</span><br></pre></td></tr></table></figure>
<p>修改如下：</p>
<p><img src="./20180320174221.png" alt="" title="修改如下"></p>
<p>重新载入nginx的配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure>
<h2 id="mysql安装"><a href="#mysql安装" class="headerlink" title="mysql安装"></a>mysql安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget -c https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">tar -zxvf mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz </span><br><span class="line">mv mysql-5.7.21-linux-glibc2.12-x86_64 /usr/<span class="built_in">local</span>/mysql</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mysql/</span><br><span class="line"></span><br><span class="line">groupadd mysql</span><br><span class="line">useradd -r -g mysql mysql</span><br></pre></td></tr></table></figure>
<p>数据库数据默认目录datadir=/var/lib/mysql，可通过vim /etc/my.cnf 查看<br>修改后的目录是 mkdir -p /usr/local/mysql/data<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql:mysql  ./</span><br></pre></td></tr></table></figure></p>
<p>初始化数据库<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/mysqld --initialize --user=mysql --basedir=/usr/<span class="built_in">local</span>/mysql --datadir=/usr/<span class="built_in">local</span>/mysql/data</span><br></pre></td></tr></table></figure></p>
<p>会生成初始root密码，记下这个问题用于首次登录./bin/mysql -uroot -p mysql</p>
<p><br></p>
<p>修改权限为root<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown -R root:root .</span><br><span class="line">chown -R mysql:mysql data</span><br></pre></td></tr></table></figure></p>
<h5 id="安装完mysql之后，登陆以后，不管运行任何命令，总是提示这个”ERROR-1820-HY000-You-must-reset-your-password-using-ALTER-USER-statement-before-executing-this-statement-”"><a href="#安装完mysql之后，登陆以后，不管运行任何命令，总是提示这个”ERROR-1820-HY000-You-must-reset-your-password-using-ALTER-USER-statement-before-executing-this-statement-”" class="headerlink" title="安装完mysql之后，登陆以后，不管运行任何命令，总是提示这个”ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.”"></a>安装完mysql之后，登陆以后，不管运行任何命令，总是提示这个”ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.”</h5><h6 id="step-1-SET-PASSWORD-PASSWORD-‘your-new-password’"><a href="#step-1-SET-PASSWORD-PASSWORD-‘your-new-password’" class="headerlink" title="step 1: SET PASSWORD = PASSWORD(‘your new password’);"></a>step 1: SET PASSWORD = PASSWORD(‘your new password’);</h6><h6 id="step-2-ALTER-USER-‘root‘-’localhost’-PASSWORD-EXPIRE-NEVER"><a href="#step-2-ALTER-USER-‘root‘-’localhost’-PASSWORD-EXPIRE-NEVER" class="headerlink" title="step 2: ALTER USER ‘root‘@’localhost’ PASSWORD EXPIRE NEVER;"></a>step 2: ALTER USER ‘root‘@’localhost’ PASSWORD EXPIRE NEVER;</h6><h6 id="step-3-flush-privileges"><a href="#step-3-flush-privileges" class="headerlink" title="step 3: flush privileges;"></a>step 3: flush privileges;</h6><h3 id="注："><a href="#注：" class="headerlink" title="注："></a>注：</h3><h4 id="修改root密码："><a href="#修改root密码：" class="headerlink" title="修改root密码："></a>修改root密码：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> mysql.user <span class="keyword">set</span> authentication_string=<span class="keyword">password</span>(<span class="string">'123qwe'</span>) <span class="keyword">where</span> <span class="keyword">user</span>=<span class="string">'root'</span> <span class="keyword">and</span> Host = <span class="string">'localhost'</span>;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="开机自启动"><a href="#开机自启动" class="headerlink" title="开机自启动"></a>开机自启动</h2><h4 id="在-usr-lib-systemd-system创建三个-service文件，内容如下："><a href="#在-usr-lib-systemd-system创建三个-service文件，内容如下：" class="headerlink" title="在/usr/lib/systemd/system创建三个.service文件，内容如下："></a>在/usr/lib/systemd/system创建三个.service文件，内容如下：</h4><h5 id="1-nginx-service"><a href="#1-nginx-service" class="headerlink" title="1.nginx.service"></a>1.nginx.service</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nginx - high performance web server</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line">ExecReload=/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/local/nginx/sbin/nginx -s stop</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<h5 id="2-mysql-service"><a href="#2-mysql-service" class="headerlink" title="2.mysql.service"></a>2.mysql.service</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=mysql</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/mysql/support-files/mysql.server start</span><br><span class="line">#ExecReload=/usr/local/mysql/support-files/mysql.server restart</span><br><span class="line">#ExecStop=/usr/local/mysql/support-files/mysql.server stop</span><br><span class="line">#PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<h5 id="3-php-fpm-service"><a href="#3-php-fpm-service" class="headerlink" title="3.php-fpm.service"></a>3.php-fpm.service</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=php</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/sbin/php-fpm</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<h5 id="4-注册service"><a href="#4-注册service" class="headerlink" title="4.注册service"></a>4.注册service</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> nginx.service <span class="comment">#设置nginx服务为自启动服务</span></span><br><span class="line">systemctl <span class="built_in">enable</span> mysql.service</span><br><span class="line">systemctl <span class="built_in">enable</span> php-fpm.service</span><br></pre></td></tr></table></figure>
<h5 id="5-启动service"><a href="#5-启动service" class="headerlink" title="5.启动service"></a>5.启动service</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx.service <span class="comment">#启动jenkins服务</span></span><br><span class="line">systemctl start mysql.service</span><br><span class="line">systemctl start php-fpm.service</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">静谧星空</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#nginx安装"><span class="nav-number">1.</span> <span class="nav-text">nginx安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-选定源码目录"><span class="nav-number">1.1.</span> <span class="nav-text">1.选定源码目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-安装PCRE库"><span class="nav-number">1.2.</span> <span class="nav-text">2.安装PCRE库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-安装zlib库"><span class="nav-number">1.3.</span> <span class="nav-text">3.安装zlib库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-安装ssl"><span class="nav-number">1.4.</span> <span class="nav-text">4.安装ssl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-安装nginx"><span class="nav-number">1.5.</span> <span class="nav-text">5.安装nginx</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#php-fpm安装配置"><span class="nav-number">2.</span> <span class="nav-text">php-fpm安装配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、编译安装php-fpm"><span class="nav-number">2.1.</span> <span class="nav-text">一、编译安装php-fpm</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装前准备"><span class="nav-number">2.1.0.1.</span> <span class="nav-text">安装前准备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#安装libiconv"><span class="nav-number">2.1.0.2.</span> <span class="nav-text">安装libiconv</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#安装php"><span class="nav-number">2.1.0.3.</span> <span class="nav-text">安装php</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-配置："><span class="nav-number">2.2.</span> <span class="nav-text">1.配置：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#php配置"><span class="nav-number">2.2.1.</span> <span class="nav-text">php配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#php-fpm配置"><span class="nav-number">2.2.2.</span> <span class="nav-text">php-fpm配置</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#修改"><span class="nav-number">2.2.2.0.1.</span> <span class="nav-text">修改</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-运行php-fpm"><span class="nav-number">2.3.</span> <span class="nav-text">2.运行php-fpm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-nginx和php-fpm整合"><span class="nav-number">2.4.</span> <span class="nav-text">3.nginx和php-fpm整合</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mysql安装"><span class="nav-number">3.</span> <span class="nav-text">mysql安装</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#安装完mysql之后，登陆以后，不管运行任何命令，总是提示这个”ERROR-1820-HY000-You-must-reset-your-password-using-ALTER-USER-statement-before-executing-this-statement-”"><span class="nav-number">3.0.0.1.</span> <span class="nav-text">安装完mysql之后，登陆以后，不管运行任何命令，总是提示这个”ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.”</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#step-1-SET-PASSWORD-PASSWORD-‘your-new-password’"><span class="nav-number">3.0.0.1.1.</span> <span class="nav-text">step 1: SET PASSWORD = PASSWORD(‘your new password’);</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#step-2-ALTER-USER-‘root‘-’localhost’-PASSWORD-EXPIRE-NEVER"><span class="nav-number">3.0.0.1.2.</span> <span class="nav-text">step 2: ALTER USER ‘root‘@’localhost’ PASSWORD EXPIRE NEVER;</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#step-3-flush-privileges"><span class="nav-number">3.0.0.1.3.</span> <span class="nav-text">step 3: flush privileges;</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注："><span class="nav-number">3.1.</span> <span class="nav-text">注：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#修改root密码："><span class="nav-number">3.1.1.</span> <span class="nav-text">修改root密码：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#开机自启动"><span class="nav-number">4.</span> <span class="nav-text">开机自启动</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#在-usr-lib-systemd-system创建三个-service文件，内容如下："><span class="nav-number">4.0.1.</span> <span class="nav-text">在/usr/lib/systemd/system创建三个.service文件，内容如下：</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-nginx-service"><span class="nav-number">4.0.1.1.</span> <span class="nav-text">1.nginx.service</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-mysql-service"><span class="nav-number">4.0.1.2.</span> <span class="nav-text">2.mysql.service</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-php-fpm-service"><span class="nav-number">4.0.1.3.</span> <span class="nav-text">3.php-fpm.service</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-注册service"><span class="nav-number">4.0.1.4.</span> <span class="nav-text">4.注册service</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-启动service"><span class="nav-number">4.0.1.5.</span> <span class="nav-text">5.启动service</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">静谧星空</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
